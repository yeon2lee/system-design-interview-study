## 4장 처리율 제한 장치의 설계

**처리율 제한 장치(rate limiter)**
- 클라이언트 또는 서비스가 보내는 트래픽의 처리율(rate)을 제어하기 위한 장치
- ex) HTTP: 특정 기간 내에 전송되는 클라이언트의 요청 횟수 제어
- 장점
  - DoS(Denial of Service) 공격에 의한 자원 고갈(resource starvation) 방지
  - 비용 절감
  - 서버 과부하 막음

### 1단계 문제 이해 및 설계 범위 확장
- 설정된 처리율을 초과하는 요청은 정확하게 제한
- 낮은 응답시간: HTTP 응답시간에 나쁜 영향을 주면 안됨
- 가능한 한 적은 메모리
- 분산형 처리율 제한(distributed rate limiting): 하나의 처리율 제한 장치를 여러 서버나 프로세스에서 공유할 수 있어야 함
- 예외 처리: 요청이 제한되었을 때 사용자에게 분명하게 보여주어야 함
- 높은 결함 감내성(fault tolerance): 제한 장치에 장애가 생기더라도 전체 시스템에 영향을 주어서는 안됨


### 2단계 개략적 설계안 제시 및 동의 구하기
- 기본적인 클라이언트-서버 통신 모델 사용

#### 처리율 제한 장치는 어디에 둘 것인가?
- 클라이언트 측
  - 클라이언트 요청은 쉽게 위변조가 가능
- 서버 측 
  ![서버 측 처리율 제한 장치](images/nayeon/rate_limiter_server.png)
  <br><br>
  ![처리율 제한 미들웨어](images/nayeon/rate_limiter_middleware.png)
  ![429 ERROR](images/nayeon/rate_limiter_middleware_429.png)
  - 처리율 제한 미들웨어(middleware) 
    - HTTP 상태 코드 429: 사용자가 너무 많은 요청을 보내려고 했음(Too many requests)을 알림

#### 클라우드 마이크로서비스
  - API 게이트웨이에 구현
    - 처리율 제한을 지원하는 미들웨어
    - 처리율 제한, SSL 종단(termination), 사용자 인증(authentication), IP 허용목록(whitelist) 관리 등을 지원하는 완전 위탁관리형 서비스
    -> 클라우드 업체가 유지 보수를 담당하는 서비스
  
#### 처리율 제한 알고리즘
- 토큰 버킷(token bucket)
- 누출 버킷(leaky bucket)
- 고정 윈도 카운터(fixed window counter)
- 이동 윈도 로그(sliding window log)
- 이동 윈도 카운터(sliding window counter)

